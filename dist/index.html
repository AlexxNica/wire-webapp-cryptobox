<!DOCTYPE html>
<!-- Wire, Copyright (C) 2016 Wire Swiss GmbH -->
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Demo</title>
    <link rel="shortcut icon" href="data:image/x-icon;" type="image/x-icon" />
    <script src="lib/dynamic/bazinga64/bazinga64.js"></script>
    <script src="lib/dynamic/dexie/dexie.js"></script>
    <script src="lib/dynamic/lodash/lodash.js"></script>
    <script src="lib/dynamic/logdown/logdown.js"></script>
    <script src="lib/dynamic/wire-webapp-lru-cache/LRUCache.js"></script>
    <script src="lib/dynamic/wire-webapp-proteus/proteus.js"></script>
    <script src="window/wire-webapp-cryptobox.js"></script>
  </head>
  <body>
    <script>
      var logger = new Logdown({prefix: 'Demo', alignOutput: true});
      logger.log(`Testing Cryptobox v${cryptobox.version}`);

      var storage = new cryptobox.store.IndexedDB('bundle_test');
      var box = new cryptobox.Cryptobox(storage, 5);
      box.on(cryptobox.Cryptobox.TOPIC.NEW_PREKEYS, function(preKeys) {
        logger.log(`Received more PreKeys`, preKeys);
      });

      box.init().then(function(initialPreKeys) {
        var fingerprint = box.identity.public_key.fingerprint();
        var message = `Local identity: ${fingerprint}`;
        logger.log(message);
        logger.log(`Initial PreKeys`, initialPreKeys);
        document.write(message);
      });
    </script>
  </body>
</html>
