<!DOCTYPE html>
<!-- Wire, Copyright (C) 2016 Wire Swiss GmbH -->
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Demo</title>
    <link rel="shortcut icon" href="data:image/x-icon;" type="image/x-icon" />
    <script src="lib/dynamic/bazinga64/bazinga64.js"></script>
    <script src="lib/dynamic/dexie/dexie.js"></script>
    <script src="lib/dynamic/lodash/lodash.js"></script>
    <script src="lib/dynamic/logdown/logdown.js"></script>
    <script src="lib/dynamic/postal.js/postal.js"></script>
    <script src="lib/dynamic/wire-webapp-lru-cache/LRUCache.js"></script>
    <script src="lib/dynamic/wire-webapp-proteus/proteus.js"></script>
    <script src="window/wire-webapp-cryptobox.js"></script>
  </head>
  <body>
    <script>
      postal.subscribe({
        channel: cryptobox.Cryptobox.prototype.CHANNEL_CRYPTOBOX,
        topic: cryptobox.Cryptobox.prototype.TOPIC_NEW_PREKEYS,
        callback: function(data) {
          var logger = new Logdown({prefix: 'postal', alignOutput: true});
          logger.log(`Received "${data.length}" new PreKey(s).`, data);
        }
      });

      var storage = new cryptobox.store.IndexedDB('bundle_test');
      var box = new cryptobox.Cryptobox(storage, 5);

      box.init().then(function() {
        var logger = new Logdown({prefix: 'bundle_test', alignOutput: true});
        var fingerprint = box.identity.public_key.fingerprint();
        var message = 'Local Identity: ' + fingerprint;
        logger.log(message);
        document.write(message);
      });
    </script>
  </body>
</html>
